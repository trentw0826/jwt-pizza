# Learning notes

## JWT Pizza code study and debugging

As part of `Deliverable ⓵ Development deployment: JWT Pizza`, start up the application and debug through the code until you understand how it works. During the learning process fill out the following required pieces of information in order to demonstrate that you have successfully completed the deliverable.

| User activity                                                       | Frontend component        | Pizza service endpoints                               | Pizza factory endpoints    | Example API call                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Example response                                                                                                                                                                                                        | Database SQL                                                                                                                                                             |
| ------------------------------------------------------------------- | ------------------------- | ----------------------------------------------------- | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| View home page                                                      | `home.tsx`                | _none_                                                | _none_                     | _none_                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | _none_                                                                                                                                                                                                                  | _none_                                                                                                                                                                   |
| Register new user ([t@jwt.com](mailto:t@jwt.com), pw: test)         | `register.tsx`            | `[POST] /api/auth`                                    | _none_                     | `curl -X POST localhost:3000/api/auth -d '{"name":"pizza diner","email":"d@jwt.com","password":"diner"}' -H 'Content-Type: application/json'`                                                                                                                                                                                                                                                                                                                                        | `{"user":{"name":"pizza diner","email":"d@jwt.com","roles":[{"role":"diner"}],"id":10},"token":"ttttttt"}`                                                                                                              | `INSERT INTO user (name, email, password) VALUES (?, ?, ?)` `INSERT INTO userRole (userId, role, objectId) VALUES (?, ?, ?)`                                             |
| Login new user ([t@jwt.com](mailto:t@jwt.com), pw: test)            | `login.tsx`               | `[PUT] /api/auth`                                     | _none_                     | `curl -X PUT localhost:3000/api/auth -d '{"email":"u@jwt.com","password":"user"}' -H 'Content-Type: application/json'`                                                                                                                                                                                                                                                                                                                                                               | `{"user":{"id":1,"name":"常用名字","email":"a@jwt.com","roles":[{"role":"admin"}]},"token":"ttttttt"}`                                                                                                                  | `SELECT * FROM user WHERE email=?` `INSERT INTO auth (token, userId) VALUES (?, ?) ON DUPLICATE KEY UPDATE token=token`                                                  |
| Order pizza                                                         | `menu.tsx`, `payment.tsx` | `[POST] /api/order`                                   | `[POST] /api/order`        | `curl -X POST localhost:3000/api/order -H 'Content-Type: application/json' -d '{"franchiseId":1,"storeId":1,"items":[{"menuId":1,"description":"Veggie","price":0.05}]}' -H 'Authorization: Bearer tttttt'` `curl -X POST $host/api/order -H 'Authorization: Bearer xyz' -d '{"diner":{"id":719,"name":"j","email":"j@jwt.com"},"order":{"items":[{"menuId":1,"description":"Veggie","price":0.0038}],"storeId":"5","franchiseId":4,"id":278}}' -H 'Content-Type: application/json'` | `{"order":{"items":[{"menuId":1,"description":"Veggie","price":0.0038},{"menuId":2,"description":"Pepperoni","price":0.0042}],"storeId":"1","franchiseId":1,"id":4},"jwt":"xxxxxxxxxxxxxx"}`                            | `INSERT INTO dinerOrder (dinerId, franchiseId, storeId, date) VALUES (?, ?, ?, now())` `INSERT INTO orderItem (orderId, menuId, description, price) VALUES (?, ?, ?, ?)` |
| Verify pizza                                                        | `delivery.tsx`            | _none_                                                | `[POST] /api/order/verify` | `curl -X POST $host/api/order/verify -d '{"jwt":"JWT here"}' -H 'Content-Type: application/json'`                                                                                                                                                                                                                                                                                                                                                                                    | `{"message":"valid","payload":{"vendor":{"id":"student-netid","name":"Student Name","created":"2024-06-01T00:00:00Z","validUntil":"2025-12-31T23:59:59Z"},"diner":{"name":"joe"},"order":{"pizzas":["pep","cheese"]}}}` | _none_                                                                                                                                                                   |
| View profile page                                                   | `dinerDashboard.tsx`      | _none_                                                | _none_                     | _none_                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | _none_                                                                                                                                                                                                                  | _none_                                                                                                                                                                   |
| View franchise (as diner)                                           | `franchiseDashboard.tsx`  | _none_                                                | _none_                     | _none_                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | _none_                                                                                                                                                                                                                  | _none_                                                                                                                                                                   |
| Logout                                                              | `header.tsx`              | `[DELETE] /api/auth`                                  | _none_                     | `curl -X DELETE localhost:3000/api/auth -H 'Authorization: Bearer tttttt'`                                                                                                                                                                                                                                                                                                                                                                                                           | `{"message":"logout successful"}`                                                                                                                                                                                       | `DELETE FROM auth WHERE token=?`                                                                                                                                         |
| View About page                                                     | `about.tsx`               | _none_                                                | _none_                     | _none_                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | _none_                                                                                                                                                                                                                  | _none_                                                                                                                                                                   |
| View History page                                                   | `history.tsx`             | _none_                                                | _none_                     | _none_                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | _none_                                                                                                                                                                                                                  | _none_                                                                                                                                                                   |
| Login as franchisee ([f@jwt.com](mailto:f@jwt.com), pw: franchisee) | `login.tsx`               | `[PUT] /api/auth`                                     | _none_                     | `curl -X POST localhost:3000/api/auth -d '{"name":"pizza diner","email":"f@jwt.com","password":"franchisee"}' -H 'Content-Type: application/json'`                                                                                                                                                                                                                                                                                                                                   | `{"user":{"id":3,"name":"pizza franchisee","email":"f@jwt.com","roles":[{"role":"diner"},{"objectId":1,"role":"franchisee"}]},"token":"ttttttt"}`                                                                       | `SELECT * FROM user WHERE email=?` `INSERT INTO auth (token, userId) VALUES (?, ?) ON DUPLICATE KEY UPDATE token=token`                                                  |
| View franchise (as franchisee)                                      | `franchiseDashboard.tsx`  | _none_                                                | _none_                     | _none_                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | _none_                                                                                                                                                                                                                  | _none_                                                                                                                                                                   |
| Create a store                                                      | `franchiseDashboard.tsx`  | `[POST] /api/franchise/:franchiseId/store`            | _none_                     | `curl -X POST localhost:3000/api/franchise/1/store -H 'Content-Type: application/json' -d '{"franchiseId":1,"name":"SLC"}' -H 'Authorization: Bearer tttttt'`                                                                                                                                                                                                                                                                                                                        | `{"id":7,"franchiseId":1,"name":"SLC"}`                                                                                                                                                                                 | `INSERT INTO store (franchiseId, name) VALUES (?, ?)`                                                                                                                    |
| Close a store                                                       | `franchiseDashboard.tsx`  | `[DELETE] /api/franchise/:franchiseId/store/:storeId` | _none_                     | `curl -X DELETE localhost:3000/api/franchise/1/store/1 -H 'Authorization: Bearer tttttt'`                                                                                                                                                                                                                                                                                                                                                                                            | `{"message":"store deleted"}`                                                                                                                                                                                           | `DELETE FROM store WHERE franchiseId=? AND id=?`                                                                                                                         |
| Login as admin ([a@jwt.com](mailto:a@jwt.com), pw: admin)           | `login.tsx`               | `[POST] /api/auth`                                    | _none_                     | `curl -X PUT localhost:3000/api/auth -d '{"email":"a@jwt.com","password":"admin"}' -H 'Content-Type: application/json'`                                                                                                                                                                                                                                                                                                                                                              | `{"user":{"id":1,"name":"常用名字","email":"a@jwt.com","roles":[{"role":"admin"}]},"token":"<jwt>"}`                                                                                                                    | `SELECT * FROM user WHERE email=?` `INSERT INTO auth (token, userId) VALUES (?, ?) ON DUPLICATE KEY UPDATE token=token`                                                  |
| View Admin page                                                     | `adminDashboard.tsx`      | _none_                                                | _none_                     | _none_                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | _none_                                                                                                                                                                                                                  | _none_                                                                                                                                                                   |
| Create a franchise for [t@jwt.com](mailto:t@jwt.com)                | `adminDashboard.tsx`      | `[POST] /api/franchise`                               | _none_                     | `curl -X POST localhost:3000/api/franchise -H 'Content-Type: application/json' -H 'Authorization: Bearer tttttt' -d '{"name":"pizzaPocket","admins":[{"email":"f@jwt.com"}]}'`                                                                                                                                                                                                                                                                                                       | `{"name":"pizzaPocket","admins":[{"email":"f@jwt.com","id":4,"name":"pizza franchisee"}],"id":1}`                                                                                                                       | `INSERT INTO franchise (name) VALUES (?)` `INSERT INTO userRole (userId, role, objectId) VALUES (?, ?, ?)`                                                               |
| Close the franchise for [t@jwt.com](mailto:t@jwt.com)               | `adminDashboard.tsx`      | `[DELETE] /api/franchise/:franchiseId`                | _none_                     | `curl -X DELETE localhost:3000/api/franchise/1 -H 'Authorization: Bearer tttttt'`                                                                                                                                                                                                                                                                                                                                                                                                    | `{"message":"franchise deleted"}`                                                                                                                                                                                       | `DELETE FROM store WHERE franchiseId=?` `DELETE FROM userRole WHERE objectId=?` `DELETE FROM franchise WHERE id=?`                                                       |
